# Yamafiler

YamafilerはVS Code用のテキストベースのファイルマネージャーです。

![demo](https://raw.githubusercontent.com/artakase/vscode-yamafiler/main/images/demo.gif)

"Yama" は日本語で "山" という意味です。

[英語 README](../README.md)

## 目次

- [Yamafiler](#yamafiler)
  - [目次](#目次)
  - [設定](#設定)
  - [コマンド](#コマンド)
    - [開く](#開く)
    - [Yamafiler 内での操作](#yamafiler-内での操作)
    - [ファイル操作](#ファイル操作)
      - [バッチ操作について](#バッチ操作について)
      - [ファイル・フォルダーの作成・削除](#ファイルフォルダーの作成削除)
      - [ファイル・フォルダーの編集](#ファイルフォルダーの編集)
    - [フォルダーをまたいだ操作 (コピー・移動・リンク作成)](#フォルダーをまたいだ操作-コピー移動リンク作成)
      - [ファイル・フォルダーを選ぶコマンド](#ファイルフォルダーを選ぶコマンド)
      - [操作を実行するコマンド](#操作を実行するコマンド)
    - [ファイル選択](#ファイル選択)
  - [ライセンス](#ライセンス)
  - [感謝](#感謝)

## 設定

`yamafiler.useRecommendedKeybindings` - 以下に示す推奨のキーバインドを使用します。

| キー                                            | 操作                                                          |
| ----------------------------------------------- | ------------------------------------------------------------- |
| `Ctrl+Shift+Y`                                  | Yamafiler を起動する                                          |
| ``Shift+` `` <br>日本語キーボードでは `Shift+'` | ホームフォルダーを閲覧する                                    |
| `O`                                             | カレントフォルダーを隣のエディターグループでも閲覧する        |
| `H`                                             | 親フォルダーを閲覧する                                        |
| `J`                                             | カーソルを下に移動                                            |
| `K`                                             | カーソルを上に移動                                            |
| `L`                                             | カーソル行のファイルを開く/フォルダーを閲覧する               |
| `E`/`Enter`                                     | カーソル行のファイルをテキストとして開く/フォルダーを閲覧する |
| `Shift+P`                                       | カーソル行のファイルを隣のエディターグループで閲覧する        |
| `Z`                                             | カレントフォルダーの内容を更新                                |
| `Q`                                             | フォルダーを閲覧しているタブを閉じる                          |
| `W`                                             | カーソル行のワークスペースを開く                              |
| `Shift+W`                                       | カーソル行のワークスペースを新しいウィンドウで開く            |
| `Space`                                         | 選択範囲行に`*`をつける/はずす                                |
| `Shift+8`                                       | すべての行に`*`をつける/はずす                                |
| `Shift+K`                                       | フォルダーを作成                                              |
| `Shift+N`                                       | ファイルを作成                                                |
| `Shift+M`                                       | ファイルとフォルダーを一括作成                                |
| `R`                                             | 操作対象行の名前を変更                                        |
| `C`                                             | カレントフォルダーに操作対象行を複製                          |
| `Shift+S`                                       | カレントフォルダーに操作対象行のシンボリックリンクを作成      |
| `D`                                             | 操作対象行をごみ箱に移動                                      |
| `M`                                             | 操作対象行を移動                                              |
| `Y`                                             | 操作対象行をコピー                                            |
| `Shift+T`                                       | 操作対象行をシンボリックリンクのリンク先に指定                |
| `P`                                             | カレントフォルダーに貼り付け                                  |

キーが他の拡張機能と衝突する場合は手動で調整してください。

`.pdf` ファイルをプレビューするには、`vscode-pdf` などの拡張機能が別途必要です。

この設定と同等のkeybindings.jsonは [こちら](keybindings.json) を参照してください。

## コマンド

「カーソル行」とは、カーソルがある単一の行を指します。

「選択範囲行」とは、テキストの選択範囲がある行のことを指します。複数行にも対応しています。

「操作対象行」とは、まず `*` マークがついている行を優先し、`*` マークがない場合は選択範囲内の行を指します。どちらも存在しない場合はカーソル行になります。複数行にも対応しています。

(注: カーソルや選択範囲が複数ある場合はそのうちプライマリなもの1つだけを指します)

「カレントフォルダー」とは、現在Yamafilerで閲覧しているフォルダーのことです。

`yamafiler.openFiler` 以外のコマンドはYamafilerを開いているときのみ有効です。

`yamafiler.useRecommendedKeybindings` を有効にした場合のキーを表示します。

### 開く

`yamafiler.openFiler` (`Ctrl+Shift+Y`) - Yamafilerでフォルダーを閲覧します。

- _path_ - 閲覧するフォルダーのパス。以下の特殊記法が使えます:
  - `~`: ホームフォルダー
  - `${workspaceFolder}`: 現在のワークスペースフォルダー
  - 空文字列: アクティブなファイルの親フォルダー
- _column_ = 'active' - `'active'` なら現在のエディターグループで、`'beside'` なら隣のエディターグループで開きます
- _ask_ = 'never' - `'never'` は自動的にフォルダーを選んで開きます。`'dialog'` はフォルダー選択ダイアログを表示します
- _resolveSymlinks_ = false - カーソル行がシンボリックリンクであるとき、`true` ならリンク先の実際のパスを開き、`false` ならシンボリックリンクのパスのまま開きます

### Yamafiler 内での操作

`yamafiler.enter` (`L`) - カーソル行のファイルまたはフォルダーを開きます。デフォルトではファイルはテキストファイルとして開き、フォルダーはYamafilerで閲覧します。

- _column_ = 'active' - `'active'` なら現在のエディターグループで、`'beside'` なら隣のエディターグループで開きます
- _preserveFocus_ = false - `true` ならファイルを開いてもファイラーにフォーカスを維持し、`false` ならファイルを開いたらそちらにフォーカスを移動します
- _preview_ = false - `true` ならファイルをプレビューモードで開きます
- _binaryPattern_ = '' - バイナリファイルとして開くファイルのグロブパターンです。 (例: `'*.{jpg,png}'`)
- _externalPattern_ = '' - 外部アプリケーションで開くファイルのグロブパターンです。 (例: `'*.{doc,xls}'`)
- _externalFolderPattern_ = '' - 外部アプリケーションで開くフォルダーのグロブパターンです
- _resolveSymlinks_ = false - カーソル行がシンボリックリンクであるとき、`true` ならリンク先の実際のパスを開き、`false` ならシンボリックリンクのパスのまま開く

`yamafiler.goToParent` (`H`) - カレントフォルダーの親フォルダーを閲覧します。引数はありません。

`yamafiler.refresh` (`Z`) - カレントフォルダーの内容を最新の状態に更新します (ファイルシステムの変更を反映)。

- _resetSelection_ = false - `true` なら更新時に`*`マークをすべてクリアし、`false` なら可能な限り `*` マークを保持します

`yamafiler.openWorkspace` (`W`/`Shift+W`) - カーソル行のフォルダーやワークスペースファイルをワークスペースとして開きます。

- _forceNewWindow_ = false - `true` なら新しいウィンドウで開き、`false` なら現在のウィンドウで開きます (既存のワークスペースは閉じる)
- _resolveSymlinks_ = false - カーソル行がシンボリックリンクであるとき、`true` ならリンク先の実際のパスを開き、`false` ならシンボリックリンクのパスのまま開きます

`yamafiler.addToWorkspace` - 操作対象行のファイルやフォルダーを現在のワークスペースに追加します。

- _resolveSymlinks_ = false - シンボリックリンクである行について、`true` ならリンク先の実際のパスを追加し、`false` ならシンボリックリンクのパスのまま追加します

### ファイル操作

#### バッチ操作について

Yamafilerでは、テキストファイルを利用して複数のファイル名を一度に入力する仕組みがあります。

- **バッチモード** - 複数のファイルを一度に操作する場合、テキストエディターが開きます。各行が対象ファイルに対応します。ファイルを保存すると操作が実行され、保存せずに閉じるとキャンセルされます。
- **バッチ差分モード** - 左右に分割された編集画面で、左側に元のファイル名、右側に変更後のファイル名が表示されます。右側を編集して保存すると名前変更などの操作が実行され、保存せずに閉じるとキャンセルされます。

#### ファイル・フォルダーの作成・削除

`yamafiler.newFolder` (`Shift+K`) - カレントフォルダーに新しいフォルダーを作成します。名前入力プロンプトが表示されます。

`yamafiler.newFile` (`Shift+N`) - カレントフォルダーに新しいファイルを作成します。名前入力プロンプトが表示されます。

`yamafiler.newMultipleFiles` (`Shift+M`) - カレントフォルダーにバッチモードで複数のファイルを一度に作成します。各行の名前の付け方は:

- ファイル: 末尾にスラッシュを付けない (例: `example.txt`)
- フォルダー: 末尾にスラッシュを付ける (例: `new_folder/`)

`yamafiler.delete` (`D`) - 操作対象行のファイル・フォルダーを削除します。

- _useTrash_ = true - `true` ならごみ箱に移動 (復元可能)、`false` なら完全に削除します。

#### ファイル・フォルダーの編集

`yamafiler.rename` (`R`) - 操作対象行のファイル・フォルダーの名前を変更します。

- 単一選択時:名前入力プロンプトが表示されます。
- 複数選択時:バッチ差分モードが開き、各行を編集して新しい名前を指定します。

`yamafiler.duplicate` (`C`) - 操作対象行のファイル・フォルダーを同じフォルダー内に複製します。

- 単一選択時:コピー先の名前入力プロンプトが表示されます。
- 複数選択時:バッチ差分モードで各コピー先の名前を編集できます。

`yamafiler.symlink` (`Shift+S`) - 操作対象行のファイル・フォルダーへのシンボリックリンクを作成します。

- 単一選択時:リンク名の入力プロンプトが表示されます。
- 複数選択時:バッチ差分モードで各リンク名を編集できます。

### フォルダーをまたいだ操作 (コピー・移動・リンク作成)

これらの操作はクリップボードのような概念を使って「コピー＆貼り付け」や「切り取り＆貼り付け」を行います。基本的な流れは次の通りです。

#### ファイル・フォルダーを選ぶコマンド

転送元フォルダーで操作したいファイル・フォルダーを操作対象行にして以下のいずれかを実行:

`yamafiler.cut` (`M`) - 移動するためにマーク (切り取り) します。

`yamafiler.copy` (`Y`) - 複製するためにマーク (コピー) します。 UnixやMacではフォルダーのマージもできます。

`yamafiler.targetForSymlink` (`Shift+T`) - リンク作成のリンク先としてマークします。

#### 操作を実行するコマンド

転送先フォルダーに移動して:

`yamafiler.paste` (`P`) - 準備したファイル・フォルダーをカレントフォルダーに転送します。

- **移動 (cut → paste)**: ファイル・フォルダーが元の場所から削除され、新しい場所に移動します。
- **複製 (copy → paste)**: ファイル・フォルダーが新しい場所にコピーされます。
- **リンク (targetForSymlink → paste)**: 新しい場所に元のファイル・フォルダーへのシンボリックリンクが作成されます。

### ファイル選択

`yamafiler.select` - 選択範囲行に `*` マークをつけます。

`yamafiler.deselect` - 選択範囲行から `*` マークをはずします。

`yamafiler.toggleSelection` (`Space`) - 選択範囲行の `*` マーク状態を切り替えます (つける ⇄ はずす)。

`yamafiler.toggleSelectionAll` (`Shift+8`) - すべての行の `*` マーク状態を切り替えます (つける ⇄ はずす)。

## ライセンス

[MIT](../LICENSE) licenseのもとに公開します。

## 感謝

- [Shougo/defx.nvim](https://github.com/Shougo/defx.nvim) - アイデアの源
- [shirou/vscode-dired](https://github.com/shirou/vscode-dired) - 先駆者
- [JannisX11/batch-rename](https://github.com/JannisX11/batch-rename) - バッチ機能
